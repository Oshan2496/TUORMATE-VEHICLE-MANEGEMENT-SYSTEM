#include <iostream>
#include <fstream>
#include <sstream>
#include <vector>
#include <string>

using namespace std;

struct Vehicle {
    int id;
    string model;
    string type;
    float pricePerKm;
};


vector<Vehicle> loadVehicles() {
vector<Vehicle> vehicles;
ifstream inFile("vehicles.txt");

    if (!inFile.is_open()) {
        cerr << "Error: Could not open vehicles.txt.\n";
        return vehicles;
    }

    string line;
    while (getline(inFile, line)) {
        stringstream ss(line);
        Vehicle v;
        string idStr, priceStr;
        getline(ss, idStr, ',');
        getline(ss, v.model, ',');
        getline(ss, v.type, ',');
        getline(ss, priceStr, ',');
        v.id = stoi(idStr);
        v.pricePerKm = stof(priceStr);
        vehicles.push_back(v);
    }
    inFile.close();
    return vehicles;
}

// View vehicle details
void viewVehicles() {
    vector<Vehicle> vehicles = loadVehicles();

    cout << "\n--- Available Vehicles ---\n";
    if (vehicles.empty()) {
        cout << "No vehicles found.\n";
        return;
    }

    for (const auto& v : vehicles) {
        cout << "ID: " << v.id
             << ", Model: " << v.model
             << ", Type: " << v.type
             << ", Price/km: Rs." << v.pricePerKm << endl;
    }
}

// Add a vehicle
void addVehicle() {
    Vehicle v;
    cout << "Enter Vehicle ID: "; cin >> v.id;
    cin.ignore();
    cout << "Enter Model: "; getline(cin, v.model);
    cout << "Enter Type (e.g., Sedan, SUV): "; getline(cin, v.type);
    cout << "Enter Price per Km: "; cin >> v.pricePerKm;

    ofstream outFile("vehicles.txt", ios::app);
    if (!outFile) {
        cerr << "Error: Unable to open file.\n";
        return;
    }

    outFile << v.id << "," << v.model << "," << v.type << "," << v.pricePerKm << endl;
    outFile.close();

    cout << "Vehicle added successfully.\n";
}

// Upload vehicles (overwrite all)
void uploadVehicles() {
    int n;
    cout << "How many vehicles to upload? ";
    cin >> n;
    cin.ignore();

    ofstream outFile("vehicles.txt");
    if (!outFile) {
        cerr << "Error: Unable to open file.\n";
        return;
    }

    for (int i = 0; i < n; ++i) {
        Vehicle v;
        cout << "\nVehicle " << i + 1 << ":\n";
        cout << "Enter ID: "; cin >> v.id;
        cin.ignore();
        cout << "Enter Model: "; getline(cin, v.model);
        cout << "Enter Type: "; getline(cin, v.type);
        cout << "Enter Price per Km: "; cin >> v.pricePerKm;
        cin.ignore();
        outFile << v.id << "," << v.model << "," << v.type << "," << v.pricePerKm << endl;
    }

    outFile.close();
    cout << "Vehicles uploaded successfully.\n";
}

// Delete a vehicle
void deleteVehicle() {
    int delId;
    cout << "Enter Vehicle ID to delete: ";
    cin >> delId;

    vector<Vehicle> vehicles = loadVehicles();
    bool found = false;

    ofstream outFile("vehicles.txt");
    if (!outFile) {
        cerr << "Error: Unable to open file.\n";
        return;
    }

    for (const auto& v : vehicles) {
        if (v.id != delId) {
            outFile << v.id << "," << v.model << "," << v.type << "," << v.pricePerKm << endl;
        } else {
            found = true;
        }
    }

    outFile.close();

    if (found) cout << "Vehicle deleted.\n";
    else cout << "Vehicle ID not found.\n";
}

// Placeholder for managing sales
void manageSales() {
    cout << "Sales management feature is under construction.\n";
}

// Admin login
bool login() {
    string u, p;
    cout << "Username: "; cin >> u;
    cout << "Password: "; cin >> p;
    return u == "admin" && p == "123";
}

int main() {
    if (!login()) {
        cout << "Login failed.\n";
        return 0;
    }

    int choice;
    do {
        cout << "\n=== TOURMATE CAB SERVICE MENU ===\n";
        cout << "1. View Available Vehicles\n";
        cout << "2. Add Vehicle\n";
        cout << "3. Upload Vehicles \n";
        cout << "4. Delete Vehicle\n";
        cout << "5. Manage Sales\n";
        cout << "0. Exit\n";
        cout << "Enter your choice: ";
        cin >> choice;

        switch (choice) {
            case 1: viewVehicles(); break;
            case 2: addVehicle(); break;
            case 3: uploadVehicles(); break;
            case 4: deleteVehicle(); break;
            case 5: manageSales(); break;
            case 0: cout << "Exiting...\n"; break;
            default: cout << "Invalid choice.\n";
        }
    } while (choice != 0);

    return 0;
}
